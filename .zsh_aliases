# Python Aliases
alias py='python3'
alias dpy='python3 -m debugpy --listen 5678 --wait-for-client'
alias py-dbug-connect='python3 -m debugpy --connect 5678'

alias pyact='source $(poetry env info --path)/bin/activate'
alias pydeact='source $(poetry env info --path)/bin/deactivate'

# kube
alias k8=kubectl
alias k=kustomize

# git
alias gcsam='gcs -am'
alias gcsm='git commit -S -m'

# sed to use gsed instead
# alias sed=gsed

# less

function withless() {
  $@ | less
}

# curl

function cheat() {
  curl https://cheat.sh/$@ | less
}


function curljq() {
  curl_output=$(curl "$1" "$2" 2>/dev/null)
  if [ -z "$3" ]; then
    jq_output=$(echo "$curl_output" | jq '.')
  else
    jq_output=$(echo "$curl_output" | jq "$3")
  fi
  echo "$jq_output"
}


# vim
alias vim=nvim
alias vi=nvim

function cleanvim(){
        rm /tmp/*.swp; rm /tmp/.*.swp
}

# load zsh
alias reloadsh='source ~/.zshrc'

# copy
alias copy="clipcopy"

function note(){
        cmd="display alert \\\'${@} done\\\'"
   $@ && osascript -e "display alert \" ${1//\"/\\\"} done\"" 
}

function pynote(){
        echo $1
        cmd="display alert \\\'python script ${1} done\\\'"
    python3 $@ && osascript -e "display alert \" python script ${1//\"/\\\"} done\"" 
}

# function copy(){
#   cat $1 | "pbcopy"
# }

# BB stuff
alias configkube="export KUBECONFIG=~/.kube/Patrick.Kelly-dev-config"

alias installflux="sh ./scripts/install_flux.sh -u snekcode -p $REG1PW"

alias k3ddev="sh docs/assets/scripts/developer/k3d-dev.sh"

alias update_etc_hosts='sudo sed -i "0,/^\([0-9]\{1,3\}\.\)\{3\}[0-9]\{1,3\}/{s//${CLUSTER_IP}/}" /etc/hosts'

function startcluster() {
  if [ "$(basename "$PWD")" != "bigbang" ]; then
    echo "Error: Must be in the bigbang folder"
  else
    k3ddev && configkube && installflux && osascript -e "display alert \" Cluster Built \"" 
  fi
} 

export CLUSTER_IP=15.200.241.232

# R2D2 JAWS aliases
alias jaws="cd ~/Projects/R2D2/JAWS"
alias jawsfe="cd ~/Projects/R2D2/JAWS/frontend"
alias jawscore="cd ~/Projects/R2D2/JAWS/backend/core"
alias jawscorebuild="jawscore && sh ~/Projects/R2D2/JAWS/backend/core/build.sh && cd -"
alias jawsstart="cd ~/Projects/R2D2/JAWS/frontend && sh start-dev.sh && cd -"


# P1 BB
alias readme='curl -O https://repo1.dso.mil/big-bang/product/packages/gluon/-/raw/master/docs/README.md.gotmpl && curl -O https://repo1.dso.mil/big-bang/product/packages/gluon/-/raw/master/docs/.helmdocsignore && curl -O https://repo1.dso.mil/big-bang/product/packages/gluon/-/raw/master/docs/_templates.gotmpl && docker run --rm -v "`pwd`:/helm-docs" -u $(id -u) jnorwood/helm-docs:v1.10.0 -s file -t /helm-docs/README.md.gotmpl -t /helm-docs/_templates.gotmpl --dry-run > README.md && rm .helmdocsignore README.md.gotmpl _templates.gotmpl'


# renovate config
export RENOVATE_CONFIG_JS='~/Projects/P1/Bigbang/renovate.js'

alias cd='z'



# Fuzzy search
fo() {
  local editor="nvim"
  [[ "$TERM_PROGRAM" == "vscode" ]] && editor="code"

  # Prefer .gitignore, fallback to .foignore
  local ignorefile=".gitignore"
  [[ ! -f "$ignorefile" && -f ".foignore" ]] && ignorefile=".foignore"

  local find_exclude='! -path "*/.git/*"'  # Always exclude .git by default

  if [[ -f "$ignorefile" ]]; then
    while IFS= read -r pattern; do
      # Skip comments and empty lines
      [[ -z "$pattern" || "$pattern" =~ ^# ]] && continue

      # Trim trailing slashes
      pattern="${pattern%/}"

      # Convert to find-friendly exclude flags
      if [[ "$pattern" == *'*'* ]]; then
        find_exclude+=" ! -name \"$pattern\""
      else
        find_exclude+=" ! -path \"*/$pattern/*\""
      fi
    done < "$ignorefile"
  fi

  # Run find with evaluated exclusions
  eval find . -type f $find_exclude 2>/dev/null \
    | fzf --preview "bat --color=always --style=numbers --line-range=:500 {}" \
          --multi \
          --bind "enter:become(${editor} {+})" \
          --bind "ctrl-o:execute(xdg-open {} > /dev/null 2>&1)" \
          --height=80% --layout=reverse --border \
          --prompt="Open file: "
}
